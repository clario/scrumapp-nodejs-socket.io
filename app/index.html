<html>
<head>
<script src="http://fb.me/react-0.13.0.js"></script>
<script src="http://fb.me/JSXTransformer-0.13.0.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


<!-- Latest compiled and minified JavaScript -->

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
</head>
<style>
  body{
    margin: 40px;
  }

</style>

<body>
<audio id="audio" src="http://www.soundjay.com/button/beep-21.mp3" preload="auto"  ></audio>
<script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>


  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
</body>

<h1>Dataloy Scrum</h1>
<div id="scrum"/>
<script type="text/javascript">

	var socket = io('http://192.168.1.3:8085');
 

	var user =  new Date().toString();
	console.log(user);
	
	var ppl = [];
	
  socket.on("setCookie",function(data){
      console.log(JSON.stringify(data))
      var val = data.cookieValue;
      var date = data.expires;
      var cookieString =  'user=' + val+'; expires='+ date+'; path=/';
      console.log(cookieString + " satt som cookie");
      document.cookie = cookieString;

  });

  

</script>

  <script type="text/jsx">


 

  var InputNavn = React.createClass({

	getInitialState: function(){
		return {name: ""}

	},
	componentDidMount : function(){
		
		socket.emit("send",{username:user});
	},

  	onClick: function(){
        var name = this.state.name;
  		 socket.emit("setName",{"nameOnPerson":name});

  	},
  	onChange: function(e){
  		this.setState({name:e.target.value});

  	},

  	render: function(){


  		return <div>Fyll inn navn: <input type="text" placeholder="navn" onChange={this.onChange} value={this.state.name}/>
		<button style={okStyle} className="btn btn-default"  onClick={this.onClick}>Ok</button>
  		</div>;
  	}


  });



 var Liste = React.createClass({
	getInitialState  : function(){
		
    socket.on('newList', this.newData);
    socket.on("toogleHide",this.toogleHide);

		return {array:[], hide : false};	
	},

  newData : function(data){
     
    //console.log("nyBruker joina");
     ppl = data;
     if(data){
       this.setState({array: data})
     }
   

  },

  toogleHide : function(data){
      audio.play();
     var _this = this;
     if(data.hide){
        _this.setState({hide: false});
     }else{
       _this.setState({hide: true});
     }
  
  },

	componentWillMount : function(){
		var _this = this;


	},	

  	render: function(){
		var _this = this;
		function listItem(item){
      if(!_this.state.hide){
        return <a className="list-group-item"><h3 className="list-group-item-heading">{item.name + " " + item.number}</h3></a>;
      }else{
        return <a className="list-group-item"><h3 className="list-group-item-heading">{item.name + " " + "#"}</h3></a>;
      }
		
		}

  		return <div>{this.state.array.map(listItem)}</div>;
  	}


  });

var numbers = ['?',0,1,3,5,8,13,20,40,60,100];

var divStyle = {
  "marginLeft": 10,
   "marginTop": 10,
   "fontSize": 35

};

var okStyle = {


   "fontSize": 20

};



 var ButtonNumber = React.createClass({

  	onClick : function(value){
      console.log("Setter " + value);
        socket.emit("setNumber",{number:value});

    },

    render: function(){	
      var _this = this;
		function items(item){

			return <button value={item} id={item} onClick={function(){_this.onClick(item)}} className="btn btn-primary" style={divStyle}>{item}</button>;
		}
  				
  		return <div>{this.props.numbers.map(items)}</div>;
  	}

  });

   var Test = React.createClass({
	klikk : function(){
		console.log("Kliket")
		socket.emit("random",{});
	},

  	render: function(){	
		
  				
  		return <button className="btn btn-primary" style={divStyle} onClick={this.klikk}>test</button>;
  	}

  });

    var ToogleHide = React.createClass({
  klikk : function(){
    console.log("Kliket")
    socket.emit("toogleHide",{});
  },

    render: function(){ 
    
          
      return <button className="btn btn-primary" style={divStyle} onClick={this.klikk}>ToogleHide</button>;
    }

  });

 var Restart = React.createClass({
  klikk : function(){
    console.log("Kliket")
    socket.emit("restart",{});
  },

    render: function(){ 
    
          
      return <button className="btn btn-primary" style={divStyle} onClick={this.klikk}>Restart</button>;
    }

  });


 var ScrumApp = React.createClass({
	nameSet : function(name){

		console.log(name);
	},

  	onClick: function(){
  		console.log("sender en hello");
  		socket.emit('hello', {});

  	},

  	render: function(){

				
  		return <div><InputNavn/><br/><ButtonNumber numbers={numbers}/><br/><div className="list-group"><Liste array={ppl}/></div><Test/><ToogleHide/><Restart/></div>;
  	}


  });




React.render(<ScrumApp/>,scrum);

  </script>



</html>